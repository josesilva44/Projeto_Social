{% extends 'tela_inicial/layout_base.html' %}

{% block conteudo %}
<div class="container py-4">

  <!-- CABEÇALHO -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold mb-0">
       Relatório de Aulas
    </h2>
  </div>

  <!-- DESCRIÇÃO -->
  <div class="alert alert-info d-flex align-items-center shadow-sm" role="alert">
    <i class="bi bi-info-circle-fill me-2 fs-5"></i>
    <div>
      <strong>Funcionalidade:</strong>
      Visualize todas as aulas, seus diários preenchidos e gere relatórios consolidados.
      Você também pode concluir aulas após validação dos dados registrados.
    </div>
  </div>

  <!-- LISTA DE AULAS -->
  {% if aulas %}
    <div class="card shadow-sm">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-primary text-center">
              <tr>
                <th>Aula</th>
                <th>Classe</th>
                <th>Data Prevista</th>
                <th>Trimestre</th>
                <th>Diários</th>
                <th>Status</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for aula in aulas %}
                <tr>
                  <td>
                    <strong class="text-dark">{{ aula.titulo }}</strong>
                  </td>

                  <td>{{ aula.classe.nome }}</td>

                  <td>{{ aula.data_prevista|date:"d/m/Y" }}</td>

                  <td>
                    {% if aula.trimestre %}
                      <span class="badge bg-primary">
                        {{ aula.trimestre.trimestre }}/{{ aula.trimestre.ano }}
                      </span>
                      {% if aula.trimestre.ativo %}
                        <span class="badge bg-success ms-1">Ativo</span>
                      {% endif %}
                    {% else %}
                      <span class="badge bg-secondary">N/A</span>
                    {% endif %}
                  </td>

                  <td>
                    {% with diarios_count=aula.diario_set.all|length %}
                      {% if diarios_count > 0 %}
                        <span class="badge bg-info text-dark">
                          {{ diarios_count }} preenchido(s)
                        </span>
                      {% else %}
                        <span class="badge bg-warning text-dark">
                          Nenhum
                        </span>
                      {% endif %}
                    {% endwith %}
                  </td>

                  <td>
                    {% if aula.concluida %}
                      <span class="badge bg-success">
                        <i class="bi bi-check-circle me-1"></i> Concluída
                      </span>
                    {% else %}
                      <span class="badge bg-warning text-dark">
                        <i class="bi bi-hourglass-split me-1"></i> Em andamento
                      </span>
                    {% endif %}
                  </td>

                  <td>
                    <div class="d-flex gap-2">
                      <a href="{% url 'relatorio_aula' aula.id %}"
                         class="btn btn-outline-primary btn-sm"
                         title="Ver relatório desta aula">
                        <i class="bi bi-file-earmark-text me-1"></i> Relatório
                      </a>

                      {% if not aula.concluida %}
                        <form method="POST" action="{% url 'aula_concluir' aula.id %}">
                          {% csrf_token %}
                          <button type="submit"
                                  class="btn btn-outline-success btn-sm"
                                  title="Concluir esta aula"
                                  onclick="return confirm('Tem certeza que deseja concluir esta aula?');">
                            <i class="bi bi-check-circle me-1"></i> Concluir
                          </button>
                        </form>
                      {% endif %}
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% else %}
    <div class="alert alert-secondary text-center shadow-sm" role="alert">
      <i class="bi bi-exclamation-circle me-2"></i>
      <strong>Nenhuma aula disponível.</strong>
      Inicie um trimestre e crie aulas para começar.
    </div>
  {% endif %}

</div>

{% block footer %}{% endblock %}
{% endblock conteudo %}
